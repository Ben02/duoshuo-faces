!function(p,k,v){function B(){return q.short_name?U+"//"+q.short_name+"."+d.DOMAIN:d.REMOTE}function za(){function b(){for(var b;b=sa.shift();){var e=b.url,l=new a(b.title,{dir:"auto",icon:b.iconUrl,body:b.body});try{l.onclick=function(){p.focus();Q.href=e;l.close()}}catch(d){}setTimeout(function(){l.close&&l.close()},8E3)}}var a=p.Notification;"Notification"in p&&"denied"!==a.permission&&("granted"===a.permission&&b(),a.requestPermission(function(a){"granted"===a&&b()}))}function M(){return 0==x.data.user_id}
function ta(b){d.theme=b;"none"!=b&&r.injectStylesheet(d.STATIC_URL+"/styles/embed"+(b?"."+b+".css?"+Aa[b]:"."+short_name)+".css")}var r={},ua=k.getElementsByTagName("head")[0]||k.getElementsByTagName("body")[0];if(r.extend=function(b,a){for(var c in a)b[c]=a[c];return b},r.injectScript=function(b,a){var c=k.createElement("script"),e=k.head||k.getElementsByTagName("head")[0]||k.documentElement;c.type="text/javascript";c.src=b;c.async="async";c.charset="utf-8";a&&(c.onload=c.onreadystatechange=function(b,
d){(d||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,e&&c.parentNode&&e.removeChild(c),c=v,d||a.call(p))});e.insertBefore(c,e.firstChild)},r.injectStylesheet=function(b){var a=k.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=b;ua.appendChild(a)},r.injectStyle=function(b){var a=k.createElement("style");return a.type="text/css",ua.appendChild(a),b=b.replace(/\}/g,"}\n"),a.styleSheet?a.styleSheet.cssText=b:a.appendChild(k.createTextNode(b)),
a},r.getCookie=function(b){var a,c,e;b=" "+b+"=";for(var l=k.cookie.split(";"),d=0;d<l.length;d++)if(a=" "+l[d],c=a.indexOf(b),0<=c&&c+b.length==(e=a.indexOf("=")+1))return decodeURIComponent(a.substring(e,a.length).replace(/\+/g,""));return v},r.param=function(b){var a=[],c;for(c in b)b[c]!=v&&a.push(c+"="+encodeURIComponent(b[c]));return a.join("&")},r.cssProperty=function(b,a){var c=(k.body||k.documentElement).style;if("undefined"==typeof c)return!1;if("string"==typeof c[b])return a?b:!0;var e=
["Moz","Webkit","ms"];b=b.charAt(0).toUpperCase()+b.substr(1);for(var d=0;d<e.length;d++)if("string"==typeof c[e[d]+b])return a?e[d]+b:!0},!p.DUOSHUO){for(var V in Object.prototype)return alert("Object.prototype \u4e0d\u4e3a\u7a7a\uff0c\u8bf7\u4e0d\u8981\u7ed9 Object.prototype \u8bbe\u7f6e\u65b9\u6cd5");var q,t,w=p.JSON,Q=p.location,W=p.XMLHttpRequest,D=w&&w.stringify&&p.localStorage,na=p.navigator.userAgent,U="https:"==k.location.protocol?"https:":"http:",X=0,sa=[],E=t=function(){function b(b){return a[b]||
"&amp;"}var a={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=/&(?!\w+;)|[<>"'`]/g,e=/[&<>"'`]/;return function(a){return null==a||!1===a?"":e.test(a)?a.replace(c,b):a}}(),Ba=function(b){if(b.match(/^(http|https):/))return b;var a=k.createElement("a");return a.href=b,F.hrefNormalized?a.href:a.getAttribute("href",4)};V=function(b){return function(){return b}};var L=function(){for(var b={},a=0;a<arguments.length;a++)arguments[a]&&r.extend(b,arguments[a]);return(b=r.param(b))?"?"+b:
""},R=function(){var b=r.getCookie("duoshuo_token");return b?{jwt:b}:q.remote_auth?{short_name:q.short_name,remote_auth:q.remote_auth}:v},oa=function(){if(!q&&(q=p.duoshuoQuery)){if(!q.short_name||"your_duoshuo_short_name"===q.short_name)return q=v,void alert("\u4f60\u8fd8\u6ca1\u6709\u8bbe\u7f6e\u591a\u8bf4\u57df\u540d(duoshuoQuery.short_name)\uff0c\u586b\u5165\u5df2\u6709\u57df\u540d\u6216\u521b\u5efa\u65b0\u7ad9\u70b9\uff1ahttp://duoshuo.com/create-site/");va.trigger("queryDefined")}return q},
y=function(b){return b&&b.error&&b.warn?b:{error:function(){},log:function(){},warn:function(){}}}(p.console),d=p.DUOSHUO={sourceName:{weibo:"\u65b0\u6d6a\u5fae\u535a",qq:"QQ",qzone:"QQ\u7a7a\u95f4",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",douban:"\u8c46\u74e3\u7f51",kaixin:"\u5f00\u5fc3\u7f51",sohu:"\u641c\u72d0\u5fae\u535a",baidu:"\u767e\u5ea6",google:"\u8c37\u6b4c",wechat:"\u5fae\u4fe1",weixin:"\u5fae\u4fe1",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},serviceNames:{weibo:"\u5fae\u535a",
qq:"QQ",douban:"\u8c46\u74e3",renren:"\u4eba\u4eba",kaixin:"\u5f00\u5fc3",baidu:"\u767e\u5ea6",google:"\u8c37\u6b4c",wechat:"\u5fae\u4fe1",weixin:"\u5fae\u4fe1",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},parseDate:function(b){return b.parse("2011-10-28T00:00:00+08:00")&&function(a){return new b(a)}||b.parse("2011/10/28T00:00:00+0800")&&function(a){return new b(a.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||b.parse("2011/10/28 00:00:00+0800")&&function(a){return new b(a.replace(/-/g,
"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(a){return new b(a)}}(Date),fullTime:function(b){b=d.parseDate(b);return b.getFullYear()+"\u5e74"+(b.getMonth()+1)+"\u6708"+b.getDate()+"\u65e5 "+b.toLocaleTimeString()},elapsedTime:function(b){b=d.parseDate(b);var a=new Date,c=(a-X-b)/1E3;return 10>c?"\u521a\u521a":60>c?Math.round(c)+"\u79d2\u524d":3600>c?Math.round(c/60)+"\u5206\u949f\u524d":86400>c?Math.round(c/3600)+"\u5c0f\u65f6\u524d":(a.getFullYear()==b.getFullYear()?"":b.getFullYear()+
"\u5e74")+(b.getMonth()+1)+"\u6708"+b.getDate()+"\u65e5"},compileStyle:function(b){var a="",c={};if(c.textbox="#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper",!b)return a;for(var e in b)a+=c[e]+"{"+b[e]+"}\n";return a},init:function(b,a){b&&!ca[b]&&(ca[b]=a||{type:"EmbedThread"});d.initView&&d.initView()}},Ca=k.all,F=d.support=function(){var b=k.createElement("div");b.innerHTML='<a href="/a" style="opacity:.55;">a</a><input type="checkbox"/>';var a=b.getElementsByTagName("a")[0],a={placeholder:"placeholder"in
b.getElementsByTagName("input")[0],touch:"ontouchstart"in p||"onmsgesturechange"in p,opacity:/^0.55$/.test(a.style.opacity),hrefNormalized:"/a"===a.getAttribute("href"),iOS:na.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:na.match(/ \(Linux; U; Android /)};return a.ie6=!W&&"undefined"==typeof b.style.maxHeight,a.authInWin=p.postMessage&&800<p.screen.width&&!a.iOS&&!a.android&&Q.origin,a}(),ca=d.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},
".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"},".ds-share":{type:"ShareWidget"}},S=d.openDialog=function(b){return d.dialog!==v&&d.dialog.el.remove(),d.dialog=(new h.Dialog(f.dialog(b))).open()},wa=d.smilies={};d.require=function(){function b(a){return d.STATIC_URL+"/libs/"+a+".js"+(xa[a]?"?"+xa[a]+".js":"")}var a={mzadxN:"undefined"!=typeof mzadxN};return"undefined"!=
typeof jQuery&&"1.5"<=jQuery.fn.jquery&&(a["embed.compat"]=!0,d.jQuery=p.jQuery),function(c,e){if("string"==typeof c)a[c]?e():r.injectScript(b(c),function(){a[c]=!0;e()});else if("object"==typeof c){var d,f=!0;for(d=0;d<c.length;d++)(function(k){a[c[d]]||(f=!1,r.injectScript(b(k),function(){a[k]=!0;for(var b=0;b<c.length;b++)if(!a[c[b]])return;e()}))})(c[d]);f&&e()}}}();for(var A=0,z="EmbedThread RecentComments RecentVisitors TopUsers TopThreads LoginWidget ThreadCount".split(" ");A<z.length;A++)d[z[A]]=
function(b){return function(a,c){c=c||{};c.type=b;a&&!ca[a]&&(ca[a]=c);d.initSelector&&d.initSelector(a,c)}}(z[A]),d["create"+z[A]]=function(b){return function(a,c){var e=k.createElement(a),f;for(f in c)e.setAttribute("data-"+f,c[f]);return d[b](e),e}}(z[A]);d.RecentCommentsWidget=d.RecentComments;var C=d.API={ajax:function(b,a,c,e,f){function k(a,b,c){var d,n;if(200<=a&&300>a||304===a)if(304===a)b="notmodified",n=!0;else try{d=w.parse(c),b="success",n=!0}catch(p){b="parsererror"}else{b&&!a||(b="error");
try{d=w.parse(c)}catch(p){b="parsererror"}}n?e&&e(d):"parseerror"===b?y.error("\u89e3\u6790\u9519\u8bef: "+c):(y.error("\u51fa\u9519\u5566("+d.code+"): "+d.errorMessage),f&&f(d),d.errorTrace&&y.error(d.errorTrace));(a=h.getResponseHeader("Date"))&&(X=new Date-new Date(a))}var p=r.getCookie("duoshuo_token");c=c||{};c.v=d.version;p?c.jwt=p:q.remote_auth&&(c.remote_auth=q.remote_auth);if(W&&w&&w.parse){var h=new W;if(h&&"withCredentials"in h){var n;return h.open(b,B()+"/api/"+a+".json"+("GET"==b?"?"+
r.param(c):""),!0),h.withCredentials=!0,h.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),h.send("GET"==b?null:r.param(c)),n=function(a,b){var c,e,d,f;try{if(n&&(b||4===h.readyState))if(n=v,b)4!==h.readyState&&h.abort();else{c=h.status;d=h.getAllResponseHeaders();try{f=h.responseText}catch(l){}try{e=h.statusText}catch(l){e=""}}}catch(l){b||k(-1,l)}f&&k(c,e,f,d)},void(4===h.readyState?n():h.onreadystatechange=n)}}"GET"!=b&&(c._method="POST");b="cb_"+Math.round(1E6*
Math.random());C[b]=function(a){switch(a.code){case 0:e&&e(a);break;default:f&&f(a),y.error("\u51fa\u9519\u5566("+a.code+"): "+a.errorMessage),a.errorTrace&&y.error(a.errorTrace)}};c.callback="DUOSHUO.API['"+b+"']";r.injectScript(B()+"/api/"+a+".jsonp?"+r.param(c))},get:function(b,a,c,e){return this.ajax("GET",b,a,c,e)},post:function(b,a,c,e){return this.ajax("POST",b,a,c,e)}},ya=d.ws={messages:[],send:function(b){if(!("WebSocket"in p&&w))return!1;var a=this;if(a.messages.push(w.stringify(b)),!a.webSocket){var c=
a.webSocket=new WebSocket("https:"===k.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/");c.onopen=function(){var b;if(1===c.readyState)for(;b=a.messages.shift();)c.send(b)};c.onmessage=function(a){try{var b=w.parse(a.data)}catch(c){return}switch(b.type){case "post":for(var f=0;f<d.pagelets.length;f++)a=d.pagelets[f],a.threadId==b.thread_id&&a.onMessage(b);break;case "notification":sa.push(b),za()}};p.addEventListener("beforeunload",function(){c.close()})}a.webSocket.onopen()}};
d.DOMAIN="duoshuo.com";d.STATIC_URL=U+"//static.duoshuo.com";d.REMOTE=U+"//duoshuo.com";d.version="16.6.16";var Aa={"default":"9b2a46a0",dark:"33f3a5ac",bluebox:"39a75d50",newhua:"706ba4eb",justflat:"9d72ec5a"},xa={"embed.compat":"24f8ca3f",smilies:"921e8eda"},n={post:"\u53d1\u5e03",posting:"\u6b63\u5728\u53d1\u5e03",settings:"\u8bbe\u7f6e",reply:"\u56de\u590d",like:"\u9876",repost:"\u8f6c\u53d1",report:"\u4e3e\u62a5","delete":"\u5220\u9664",reply_to:"\u56de\u590d ",reposts:"\u8f6c\u53d1",comments:"\u8bc4\u8bba",
floor:"\u697c",latest:"\u6700\u65b0",earliest:"\u6700\u65e9",hottest:"\u6700\u70ed",share_to:"\u5206\u4eab\u5230:",leave_a_message:"\u8bf4\u70b9\u4ec0\u4e48\u5427\u2026",no_comments_yet:"\u8fd8\u6ca1\u6709\u8bc4\u8bba\uff0c\u6c99\u53d1\u7b49\u4f60\u6765\u62a2",repost_reason:"\u8bf7\u8f93\u5165\u8f6c\u53d1\u7406\u7531",hot_posts_title:"\u88ab\u9876\u8d77\u6765\u7684\u8bc4\u8bba",comments_zero:"\u6682\u65e0\u8bc4\u8bba",comments_one:"1\u6761\u8bc4\u8bba",comments_multiple:"{num}\u6761\u8bc4\u8bba",
reposts_zero:"\u6682\u65e0\u8f6c\u53d1",reposts_one:"1\u6761\u8f6c\u53d1",reposts_multiple:"{num}\u6761\u8f6c\u53d1",weibo_reposts_zero:"\u6682\u65e0\u65b0\u6d6a\u5fae\u535a",weibo_reposts_one:"1\u6761\u65b0\u6d6a\u5fae\u535a",weibo_reposts_multiple:"{num}\u6761\u65b0\u6d6a\u5fae\u535a",qqt_reposts_zero:"\u6682\u65e0\u817e\u8baf\u5fae\u535a",qqt_reposts_one:"1\u6761\u817e\u8baf\u5fae\u535a",qqt_reposts_multiple:"{num}\u6761\u817e\u8baf\u5fae\u535a"},ga={get:function(b){return D?D[b]:void 0},save:function(b,
a){if(D)try{D.removeItem(b),D[b]=w.stringify(a),D.removeItem(b+":timestamp"),D[b+":timestamp"]=Math.floor((new Date-X)/1E3)}catch(c){}}},ha=d.loadRequire=function(b){if(b.visitor&&(!x.data&&b.visitor.user_id&&p.Notification&&ya.send({logged_user_id:b.visitor.user_id}),x.reset(b.visitor)),b.site&&(T.reset(b.site),ga.save("ds_site_"+q.short_name,b.site)),!d.theme&&T.data.theme&&ta(T.data.theme),b.lang&&(r.extend(n,b.lang),ga.save("ds_lang_"+q.short_name,b.lang)),b.stylesheets)for(var a=0;a<b.stylesheets.length;a++)r.injectStylesheet(b.stylesheets[a]);
if(b.nonce&&(d.nonce=b.nonce),b.style&&r.injectStyle((b.style||"")+d.compileStyle(q.component_style)),b.unread&&G.reset(b.unread),b.warnings)for(a=0;a<b.warnings.length;a++)y.warn(b.warnings[a])},Y=0,A=d.Class=function(){};A.extend=function(b){function a(){!Y&&this.init&&this.init.apply(this,arguments)}Y=1;var c=new this;Y=0;for(var e in b)c[e]=b[e];return a.prototype=c,a.prototype.constructor=a,a.extend=arguments.callee,a};var ia=d.Event=A.extend({on:function(b,a){var c=this.handlers||(this.handlers=
{});return c[b]===v&&(c[b]=[]),c[b].push(a),this},trigger:function(b,a){var c=(this.handlers||(this.handlers={}))[b];if(c)for(var e=0;e<c.length&&!1!==c[e].call(this,a);e++);return this}}),K=d.Widget=ia.extend({init:function(b,a){this.el=b;this.options=a||{};this.render()},render:function(){},reset:function(){},load:function(b){switch(b.code){case 0:ha(b);var a=this.prepare(b);a.options=r.extend(this.options,b.options);this.onload(a);break;default:this.onError(b)}},onload:function(b){this.el.html(f[this.tmpl](b))},
prepare:function(b){return b},onMessage:function(){},onError:function(b){y.error("\u51fa\u9519\u5566("+b.code+"): "+b.errorMessage);b.errorTrace&&y.error(b.errorTrace)}}),A=d.Model=ia.extend({init:function(b){this.data=b},reset:function(b){this.data=b;this.trigger("reset")},remove:function(b){this.data.splice(b,1);this.trigger("reset")},set:function(b,a){if(a===v)for(var c in b)this.data[c]=b[c];else this.data[b]=a;return this.trigger("reset"),this},toJSON:function(){return r.extend({},this.data)}}),
pa=A.extend({toJSON:function(){return r.extend({},this.data)}}),ja=A.extend({toJSON:function(){var b=r.extend({},this.data);return b.theAuthor=H[this.data.author_id]&&H[this.data.author_id].data||this.data.author,b.parents=this.data.parents||[],b}}),qa=A.extend({toJSON:function(){return r.extend({},this.data)}}),z=function(b){this.model=b};z.prototype.set=function(b){for(var a in b)b[a]&&(this[a]?this[a].set(b[a]):this[a]=new this.model(b[a]))};z.prototype.get=function(b){for(var a=0,c=[];a<b.length;a++)c[a]=
this[b[a]];return c};z.prototype.getJSON=function(b){for(var a=0,c=[];a<b.length;a++)this[b[a]]&&c.push(this[b[a]].toJSON());return c};var I={userUrl:function(b){return b.url},avatarUrl:function(b){return b.avatar_url||T.data.default_avatar_url},loginUrl:function(b,a){return a||(a={}),q.sso&&q.sso.login&&(a.sso=1,a.redirect_uri=q.sso.login),B()+"/login/"+b+"/"+L(a)},bindUrl:function(b){return B()+"/bind/"+b+"/"+L(q.sso&&q.sso.login?{sso:1,redirect_uri:q.sso.login}:null,R())},logoutUrl:function(){return B()+
"/logout/"+L(q.sso&&q.sso.logout?{sso:1,redirect_uri:q.sso.logout}:null)}},Z=["weixin","weibo","qq","renren"],aa=["douban","kaixin","baidu","google"],f=d.templates={userAnchor:function(b){return b.url?'<a rel="nofollow author" target="_blank" href="'+E(b.url)+'">'+E(b.name)+"</a>":E(b.name)},avatarImg:function(b,a){return'<img src="'+E(I.avatarUrl(b,a))+'" alt="'+E(b.name)+'"'+(a?' style="width:'+a+"px;height:"+a+'px"':"")+"/>"},avatar:function(b,a){var c=f.avatarImg(b,a),e=I.userUrl(b);return e?
'<a rel="nofollow author" target="_blank" href="'+E(e)+'" '+(b.user_id?" onclick=\"this.href='"+B()+"/user-url/?user_id="+b.user_id+"';\"":"")+' title="'+E(b.name)+'">'+c+"</a>":c},timeText:function(b){return b?'<span class="ds-time" datetime="'+b+'" title="'+d.fullTime(b)+'">'+d.elapsedTime(b)+"</span>":""},timeAnchor:function(b,a){return b?'<a href="'+a+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+b+'" title="'+d.fullTime(b)+'">'+d.elapsedTime(b)+"</a>":""},serviceIcon:function(b,
a){return'<a href="javascript:void(0)" class="ds-service-icon'+(a?"-grey":"")+" ds-"+b+'" data-service="'+b+'" title="'+d.sourceName[b]+'"></a>'},poweredBy:function(b){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+E(b)+"</a></p>"},indicator:V('<div id="ds-indicator"></div>'),waitingImg:V('<div id="ds-waiting"></div>'),loginItem:function(b,a){return'<li>    <a href="'+I[a?"bindUrl":"loginUrl"](b)+'" rel="nofollow" class="ds-service-link ds-'+b+'">'+d.serviceNames[b]+
(x.data.social_uid[b]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a></li>"}},ra=function(b){var a=[],c;for(c in b)a.push('<input type="hidden" name="'+c+'" value="'+E(b[c])+'" />');return a.join("\n")};f.commentList=function(b){var a="",c=b.list;if(c)for(var e,d=-1,h=c.length-1;h>d;)e=c[d+=1],a+='<li class="ds-comment',b.options.show_avatars&&(a+=" ds-show-avatars"),a+='" data-post-id="'+e.post_id+'">',b.options.show_avatars&&(a+='<div class="ds-avatar">'+f.avatar(e.theAuthor,b.options.avatar_size)+
"</div>"),a+='<div class="ds-meta">'+f.userAnchor(e.theAuthor),b.options.show_time&&(a+=f.timeText(e.created_at)),a+="</div>",a+=b.options.show_title?'<div class="ds-thread-title">\u5728 <a href="'+t(e.thread.url)+'#comments">'+t(e.thread.title)+'</a> \u4e2d\u8bc4\u8bba</div><div class="ds-excerpt">'+e.message+"</div>":'<a class="ds-excerpt" title="'+e.thread.title+' \u4e2d\u7684\u8bc4\u8bba" href="'+t(e.thread.url)+'#comments">'+e.message+"</a>",a+="</li>";return a};f.ctxPost=function(b){var a="";
return b.post&&(a+='<li class="ds-ctx-entry"',b.hidden&&(a+=' style="display:none"'),a+=' data-post-id="'+b.post.post_id+'"><div class="ds-avatar">'+f.avatar(b.post.theAuthor||b.post.author)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+f.userAnchor(b.post.theAuthor||b.post.author)+f.timeAnchor(b.post.created_at,b.post.url),0<=b.index&&(a+='<div class="ds-ctx-nth" title="'+d.fullTime(b.post.created_at)+'">'+(b.index+1)+n.floor+"</div>"),a+='</div><div class="ds-ctx-content">'+b.post.message,
0<=b.index&&(a+='\u3000\u3000\u3000\u3000\u3000\u3000\u3000<div class="ds-comment-actions',0<b.post.vote&&(a+=" ds-post-liked"),a+='">'+f.likePost(b.post)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+n.repost+'</a><a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+n.reply+"</a></div>"),a+="</div></div></li>"),a};f["dialog-anonymous"]=function(b){var a='<h2>\u793e\u4ea4\u5e10\u53f7\u767b\u5f55</h2><div class="ds-icons-32">',
c=b.services;if(c)for(var e,f=-1,h=c.length-1;h>f;)e=c[f+=1],a+='<a class="ds-'+e+'" href="'+I.loginUrl(e)+'">'+d.sourceName[e]+"</a>";return a+="</div>",b.options.deny_anonymous||(a+='<h2>\u4f5c\u4e3a\u6e38\u5ba2\u7559\u8a00</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+t(x.data.name)+'" required /><label for="ds-dialog-name">\u540d\u5b57(\u5fc5\u586b)</label></div>',b.options.require_guest_email&&(a+='<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+
t(x.data.email)+'" required /><label for="ds-dialog-email">\u90ae\u7bb1(\u5fc5\u586b)</label></div>'),b.options.require_guest_url&&(a+='<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+t(x.data.url)+'" /><label for="ds-dialog-url">\u7f51\u5740(\u53ef\u9009)</label></div>'),a+='<button type="submit">\u53d1\u5e03</button></form>'),a};f["dialog-ask-for-auth"]=function(){return'<h2>\u793e\u4ea4\u5e10\u53f7\u767b\u5f55</h2><ul class="ds-service-list">'+
f.serviceList(Z)+'</ul><ul class="ds-service-list ds-additional-services">'+f.serviceList(aa)+"</ul>"};f["dialog-bind-more"]=function(){return'<h2>\u7ed1\u5b9a\u66f4\u591a\u5e10\u53f7</h2><ul class="ds-service-list">'+f.serviceBindList(Z)+'</ul><ul class="ds-service-list ds-additional-services">'+f.serviceBindList(aa)+'</ul><div style="clear:both"></div>'};f["dialog-qrcode"]=function(b){return'<h2>\u5fae\u4fe1\u626b\u4e00\u626b\uff0c\u5206\u4eab\u5230\u670b\u53cb\u5708</h2><div class="ds-share-qrcode" style="text-align:center;"><img src="'+
b.qrcode_url+'" alt="'+b.url+'"></div>'};f["dialog-reposts"]=function(b){var a='<h2>\u8f6c\u53d1\u5230\u5fae\u535a</h2><div class="ds-quote"><strong>@'+t(b.post.theAuthor.name)+"</strong>: "+b.post.message+"</div><form>"+ra({post_id:b.post.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter\u5feb\u6377\u63d0\u4ea4" placeholder="'+t(n.repost_reason)+'">'+t(b.repostMessage)+'</textarea><pre class="ds-hidden-text"></pre>';return a+='</div><div class="ds-actions">',
b.service?a+=ra({"service[]":b.service}):(a+='<label><input type="checkbox" name="service[]" value="weibo"',x.data.social_uid.weibo&&(a+=' checked="checked"'),a+=' /><span class="ds-service-icon ds-weibo"></span>\u65b0\u6d6a\u5fae\u535a</label><label><input type="checkbox" name="service[]" value="qqt"',x.data.social_uid.qq&&(a+=' checked="checked"'),a+=' /><span class="ds-service-icon ds-qqt"></span>\u817e\u8baf\u5fae\u535a</label>'),a+('<button type="submit">'+n.repost+"</button></div></form>")};
f.dialog=function(b){return'<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+b+'</div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a></div></div>'};f.hotPosts=function(b){var a='<div class="ds-header ds-gradient-bg">'+t(n.hot_posts_title)+"</div><ul>",c=b.list;if(c)for(var d,
l=-1,h=c.length-1;h>l;)d=c[l+=1],a+=f.post({post:d,options:b.options});return a+"</ul>"};f.likePost=function(b){var a='<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>'+n.like;return 0<b.likes&&(a+="("+b.likes+")"),a+"</a>"};f.likeTooltip=function(b){var a='<div class="ds-like-tooltip ds-rounded"><p>\u5f88\u9ad8\u5174\u4f60\u80fd\u559c\u6b22\uff0c\u5206\u4eab\u4e00\u4e0b\u5427\uff1a</p><ul>',c;for(c in b.services)a+='<li><a class="ds-share-to-'+c+" ds-service-link ds-"+
c+'" href="'+B()+"/share-proxy/?"+r.param({service:c,thread_id:b.thread_id})+'">'+b.services[c]+"</a></li>";return a+'</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">\u7b97\u4e86</a></p></div>'};f.loginButtons=function(){return'<div class="ds-login-buttons"><p>\u793e\u4ea4\u5e10\u53f7\u767b\u5f55:</p><div class="ds-social-links"><ul class="ds-service-list">'+f.serviceList(Z)+'<li><a class="ds-more-services" href="javascript:void(0)">\u66f4\u591a\u00bb</a></li></ul><ul class="ds-service-list ds-additional-services">'+
f.serviceList(aa)+"</ul></div></div>"};f.loginWidget=function(b){var a='<div class="ds-icons-32">';if(b)for(var c,e=-1,f=b.length-1;f>e;)c=b[e+=1],a+='<a class="ds-'+c+'" href="'+I.loginUrl(c)+'">'+d.sourceName[c]+"</a>";return a+"</div>"};f.meta=function(b){var a='<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded';return 0<b.user_vote&&(a+=" ds-thread-liked"),a+='"><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">',a+=0<b.user_vote?
"\u5df2\u559c\u6b22":"\u559c\u6b22",a+'</span><span class="ds-thread-cancel-like">\u53d6\u6d88\u559c\u6b22</span></a><span class="ds-like-panel"></span></div>'};f.notify=function(b){var a='<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="\u591a\u8bf4"></a><ul class="ds-notify-unread"><li';return b.comments||(a+=' style="display:none;"'),a+='><a data-type="unread-comments" href="javascript:void(0);">\u4f60\u6709'+b.comments+"\u6761\u65b0\u56de\u590d</a></li><li",
b.notifications||(a+=' style="display:none;"'),a+('><a data-type="unread-notifications" href="javascript:void(0);">\u4f60\u6709'+b.notifications+"\u6761\u7cfb\u7edf\u6d88\u606f</a></li></ul></div>")};f.post=function(b){var a="",c=b.post;b=b.options;for(var e=c.author,l,h="";l=c.message.match(/\$\s*<img[^\>]*?title=\"\[\s*:(a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x):\s*\]\"[^\>]*?class=\"ds\-smiley\"[^\>]*?>/);)c.message=c.message.replace(l[0],'<img src="http://labcdn.qiniudn.com/sm/QQ2016/'+
l[1].trim()+'.jpg" class="biaoqing qq" no-zoom />');for(;l=c.message.match(/\$\[\s*:(a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x):\s*\]/);)c.message=c.message.replace(l[0],'<img src="http://labcdn.qiniudn.com/sm/QQ2016/'+l[1]+'.jpg" class="biaoqing qq" no-zoom />');for(;l=c.message.match(/\#\s*<img[^\>]*?title=\"\[\s*(aru\_\d{1,3})\s*\]\"[^\>]*?class=\"ds\-smiley\"[^\>]*?>/);)c.message=c.message.replace(l[0],'<img src="http://labcdn.qiniudn.com/sm/ARU/'+l[1].trim()+'.png" class="biaoqing aru" no-zoom />');
for(;l=c.message.match(/\#\[\s*(aru\_\d{1,3})\s*\]/);)c.message=c.message.replace(l[0],'<img src="http://labcdn.qiniudn.com/sm/ARU/'+l[1]+'.png" class="biaoqing aru" no-zoom />');for(;l=c.message.match(/\#\s*<img[^\>]*?title=\"\[\s*(dog\d{1,2}|aini|aoteman|baibai|beishang|bishi|bizui|chanzui|chijing|dahaqi|dalian|ding|doge|feizao|ganmao|geili|guzhang|haha.|haixiu|hehe|heixian|heng|huaxin|hufen|jiong|jiyan|keai|kelian|ku|kun|landelini|lei|meng|miao|nanhaier|nu|numa|nvhaier|qian|qinqin|shayan|shengbing|shenma|shenshou|shiwang|shuai|shuijiao|sikao|taikaixin|touxiao|tu|tuzi|v5|wabishi|weiqu|xi|xiaoku|xiongmao|xixi|xu|yinxian|yiwen|youhengheng|yun|zhi|zhuakuang|zhutou|zuiyou|zuohengheng)\s*\]\"[^\>]*?class=\"ds\-smiley\"[^\>]*?>/);)c.message=
c.message.replace(l[0],'<img src="http://labcdn.qiniudn.com/sm/Doge/'+l[1].trim()+'.png" class="biaoqing doge" no-zoom />');for(;l=c.message.match(/\#\[\s*(dog\d{1,2}|aini|aoteman|baibai|beishang|bishi|bizui|chanzui|chijing|dahaqi|dalian|ding|doge|feizao|ganmao|geili|guzhang|haha.|haixiu|hehe|heixian|heng|huaxin|hufen|jiong|jiyan|keai|kelian|ku|kun|landelini|lei|meng|miao|nanhaier|nu|numa|nvhaier|qian|qinqin|shayan|shengbing|shenma|shenshou|shiwang|shuai|shuijiao|sikao|taikaixin|touxiao|tu|tuzi|v5|wabishi|weiqu|xi|xiaoku|xiongmao|xixi|xu|yinxian|yiwen|youhengheng|yun|zhi|zhuakuang|zhutou|zuiyou|zuohengheng)\s*\]/);)c.message=
c.message.replace(l[0],'<img src="http://labcdn.qiniudn.com/sm/Doge/'+l[1]+'.png" class="biaoqing doge" no-zoom />');for(void 0!=window.devicePixelRatio&&1.49<=window.devicePixelRatio&&(h="@2x");l=c.message.match(/\#\s*<img[^\>]*?title=\"\[\s*(\u5475\u5475|\u554a|\u9119\u89c6|\u4e0d\u9ad8\u5174|\u5f69\u8679|\u8336\u676f|\u5927\u62c7\u6307|\u706f\u6ce1|\u4e56|\u54c8\u54c8|\u6c57|\u9ed1\u7ebf|\u547c|\u82b1\u5fc3|\u6ed1\u7a3d|\u60ca\u54ed|\u60ca\u8bb6|\u5f00\u5fc3|\u9177|\u72c2\u6c57|\u6cea|\u51b7|\u793c\u7269|\u73ab\u7470|\u52c9\u5f3a|\u6012|\u55b7|\u94b1|\u94b1\u5e01|\u5f31|\u751f\u6c14|\u80dc\u5229|\u7761\u89c9|\u592a\u5f00\u5fc3|\u5410|\u5410\u820c|\u59d4\u5c48|\u7b11\u773c|\u54a6|\u7591\u95ee|\u9634\u9669|\u97f3\u4e50|\u771f\u68d2|haha)\s*\]\"[^\>]*?class=\"ds\-smiley\"[^\>]*?>/);)c.message=
c.message.replace(l[0],'<img src="http://labcdn.qiniudn.com/sm/paopao/'+l[1].trim()+h+'.png" class="biaoqing paopao" no-zoom />');for(;l=c.message.match(/\#\[\s*(\u5475\u5475|\u554a|\u9119\u89c6|\u4e0d\u9ad8\u5174|\u5f69\u8679|\u8336\u676f|\u5927\u62c7\u6307|\u706f\u6ce1|\u4e56|\u54c8\u54c8|\u6c57|\u9ed1\u7ebf|\u547c|\u82b1\u5fc3|\u6ed1\u7a3d|\u60ca\u54ed|\u60ca\u8bb6|\u5f00\u5fc3|\u9177|\u72c2\u6c57|\u6cea|\u51b7|\u793c\u7269|\u73ab\u7470|\u52c9\u5f3a|\u6012|\u55b7|\u94b1|\u94b1\u5e01|\u5f31|\u751f\u6c14|\u80dc\u5229|\u7761\u89c9|\u592a\u5f00\u5fc3|\u5410|\u5410\u820c|\u59d4\u5c48|\u7b11\u773c|\u54a6|\u7591\u95ee|\u9634\u9669|\u97f3\u4e50|\u771f\u68d2|haha)\s*\]/);)c.message=
c.message.replace(l[0],'<img src="http://labcdn.qiniudn.com/sm/paopao/'+l[1]+h+'.png" class="biaoqing paopao" no-zoom />');c.message=c.message.replace(/http:\/\/static\.duoshuo\.com\//g,"http://static.duoshuo.com/");c.message=c.message.replace(/http:\/\/img\.t\.sinajs\.cn\//g,"http://img.t.sinajs.cn/");if(a+='<li class="ds-post" data-post-id="'+c.post_id+'"><div class="ds-post-self" data-post-id="'+c.post_id+'" data-thread-id="'+c.thread_id+'" data-root-id="'+c.root_id+'" data-source="'+c.source+
'"><div class="ds-avatar"',e.user_id&&(a+=' data-user-id="'+e.user_id+'"'),a+=">"+f.avatar(e),d.sourceName[c.source]&&(a+=f.serviceIcon(c.source)),a+='</div><div class="ds-comment-body"><div class="ds-comment-header">',e.url?(a+='<a class="ds-user-name ds-highlight" data-qqt-account="'+(e.qqt_account||"")+'" href="'+t(e.url)+'" ',e.user_id&&(a+=" onclick=\"this.href='"+B()+"/user-url/?user_id="+e.user_id+"';\""),a+=' rel="nofollow" target="_blank"',e.user_id&&(a+=' data-user-id="'+e.user_id+'"'),
a+=">"+t(e.name)+"</a>"):(a+='<span class="ds-user-name"',e.user_id&&(a+=' data-user-id="'+e.user_id+'"'),a+=' data-qqt-account="'+(e.qqt_account||"")+'">'+t(e.name)+"</span>"),a+="</div>",1==b.max_depth&&b.show_context&&c.parents.length){a+='<ol id="ds-ctx">';if(l=J.getJSON(c.parents))for(var e=-1,k=l.length-1;k>e;)h=l[e+=1],1==e&&2<c.parents.length&&(a+='<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">\u8fd8\u6709'+(c.parents.length-2)+"\u6761\u8bc4\u8bba</a></li>"),a+=
f.ctxPost({post:h,index:e,hidden:e&&e<c.parents.length-1});a+="</ol>"}if(a+="<p>",c.parents.length>=b.max_depth&&(!b.show_context||1<b.max_depth)&&c.parent_id&&J[c.parent_id]&&(a+='<a class="ds-comment-context" data-post-id="'+c.post_id+'" data-parent-id="'+c.parent_id+'">'+n.reply_to+t(J[c.parent_id].toJSON().author.name)+": </a>"),a+=c.message+'</p><div class="ds-comment-footer ds-comment-actions',0<c.vote&&(a+=" ds-post-liked"),a+='">',a+=c.url?f.timeAnchor(c.created_at,c.url):f.timeText(c.created_at),
"duoshuo"==c.source?(a+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+n.reply+"</a>"+f.likePost(c)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+n.repost+'</a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>'+n.report+"</a>",c.privileges["delete"]&&(a+='<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"></span>'+
n["delete"]+"</a>")):("qqt"==c.source||"weibo"==c.source)&&(a+='<a class="ds-weibo-comments" href="javascript:void(0);">'+n.comments,c.type.match(/\-comment$/)||(a+='(<span class="ds-count">'+c.comments+"</span>)"),a+='</a><a class="ds-weibo-reposts" href="javascript:void(0);">'+n.reposts,c.type.match(/\-comment$/)||(a+='(<span class="ds-count">'+c.reposts+"</span>)"),a+="</a>"),a+="</div></div></div>",1<b.max_depth&&(c.childrenArray||c.children)&&"weibo"!=c.source&&"qqt"!=c.source){a+='<ul class="ds-children">';
if(l=J.getJSON(c.childrenArray||c.children))for(e=-1,h=l.length-1;h>e;)c=l[e+=1],a+=f.post({post:c,options:b});a+="</ul>"}return a+"</li>"};f.postListHead=function(b){var a='<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+n.latest+'</a><a class="ds-order-asc">'+n.earliest+'</a><a class="ds-order-hot">'+n.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"></a></li>';return b.options.show_reposts&&
b.thread.reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"></a></li>'),a+=" ",b.options.show_weibo&&b.thread.weibo_reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"></a></li>'),a+=" ",b.options.show_qqt&&b.thread.qqt_reposts&&(a+='<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"></a></li>'),a+"</ul></div>"};f.recentVisitors=function(b){var a="",c=b.response;if(c)for(var d,l=-1,h=c.length-
1;h>l;)d=c[l+=1],a+='<div class="ds-avatar">'+f.avatar(d,b.options.avatar_size)+"</div>";return a};f["related-read"]=function(b){var a="";if(b&&b.length){a+='<article class="ds-reads-expand"><div class="ds-header">\u5934\u6761\u63a8\u8350</div><section> ';if(b)for(var c,d=-1,f=b.length-1;f>d;){if(c=b[d+=1],a+=' <a href="'+c.url+'" class="ds-reads-item"> ',3==c.imgs.length){var a=a+(" <h2>"+c.title+'</h2> <div class="ds-reads-pics"> <ul> '),h=c.imgs;if(h)for(var k,n=-1,p=h.length-1;p>n;)k=h[n+=1],
a+=' <li> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+k+');"></div> </li> ';a+=' </ul> </div> <div class="ds-reads-info"> ';1==c.type&&(a+=' <span class="ds-reads-app-special">\u6253\u5f00\u5934\u6761\u9605\u8bfb</span> ');a+=' <span class="ds-reads-date" data-date="'+c.timeStamp+'"></span> </div> '}else a+=' <div class="ds-reads-desc ',c.imgs.length||(a+="ds-reads-only"),a+='"> <div class="ds-reads-title">'+c.title+'</div> <div class="ds-reads-info"> ',
1==c.type&&(a+=' <span class="ds-reads-app-special">\u6253\u5f00\u5934\u6761\u9605\u8bfb</span> '),a+=' <span class="ds-reads-date" data-date="'+c.timeStamp+'"></span> </div> </div> ',c.imgs.length&&(a+=' <div class="ds-reads-pic-right"> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+c.imgs[0]+');"> ',c.hasVideo&&(a+=' <div class="ds-reads-vid-info"><span>'+c.videoDuration+"</span></div> "),a+=" </div> </div> "),a+=" ";a+=" </a> "}a+="</section></article>"}return a};
f.replybox=function(b){var a='<div class="ds-replybox"><a class="ds-avatar"';if(a+=M()?' href="javascript:void(0);" onclick="return false"':' href="'+d.REMOTE+"/settings/avatar/"+L(R())+'" target="_blank" title="\u8bbe\u7f6e\u5934\u50cf"',a+=">"+f.avatarImg(x.data)+'</a><form method="post">'+ra(b.params)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter\u5feb\u6377\u63d0\u4ea4" placeholder="'+t(n.leave_a_message)+'"></textarea><pre class="ds-hidden-text"></pre>',
a+="</div>",a+='<div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">',!M()&&x.data.repostOptions){a+='<input id="ds-sync-checkbox';b.inline&&(a+="-inline");a+='" type="checkbox" name="repost" ';b.checked&&(a+='checked="checked" ');a+='value="'+b.repostArray.join(",")+'"> <label for="ds-sync-checkbox';b.inline&&(a+="-inline");var a=a+('">'+n.share_to+"</label>"),c;for(c in x.data.repostOptions)a+=f.serviceIcon(c,!x.data.repostOptions[c])}return a+="</span>",
a+="</div>",a+='<button class="ds-post-button" type="submit">'+t(n.post)+'</button><div class="ds-toolbar-buttons">',b.options.use_smilies&&(a+='<a class="ds-toolbar-button ds-add-emote" title="\u63d2\u5165\u8868\u60c5"></a>'),b.options.use_images&&b.options.parse_html_enabled&&(a+='<a class="ds-toolbar-button ds-add-image" title="\u63d2\u5165\u56fe\u7247"></a>'),a+="</div></div>",a+"</form></div>"};f.serviceBindList=function(b){var a="";if(b)for(var c,e=-1,f=b.length-1;f>e;)c=b[e+=1],a+='<li><a href="'+
I.bindUrl(c)+'" rel="nofollow" class="ds-service-link ds-'+c+'">'+d.serviceNames[c],x.data.social_uid[c]&&(a+=' <span class="ds-icon ds-icon-ok"></span>'),a+="</a></li>";return a};f.serviceList=function(b){var a="";if(b)for(var c,e=-1,f=b.length-1;f>e;)c=b[e+=1],a+='<li><a href="'+I.loginUrl(c)+'" rel="nofollow" class="ds-service-link ds-'+c+'">'+d.serviceNames[c]+"</a></li>";return a};f.shareWidget=function(b){var a='<div class="ds-share-icons"> <div class="ds-share-icons-inner"> <ul class="ds-share-icons-16"> ',
c=b.services;if(c)for(var e,f=-1,h=c.length-1;h>f;)e=c[f+=1],a+=' <li> <a class="ds-'+e+'" href="javascript:void(0);" data-service="'+e+'">'+d.sourceName[e]+"</a> </li> ";return a+(' </ul> </div> <div class="ds-share-icons-footer">'+b.copyright+"</div></div>")};f.smiliesTooltip=function(b){var a='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">',c;for(c in b)a+="<li><a>"+c+"</a></li>";return a+'</ul><div class="ds-smilies-container"></div></div>'};f.toolbar=function(){var b='<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>\u5e10\u53f7\u7ba1\u7406</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">\u7ed1\u5b9a\u66f4\u591a</a></li><li><a target="_blank" href="'+
d.REMOTE+"/settings/"+L(R())+'">'+t(n.settings)+'</a></li><li><a rel="nofollow" href="'+I.logoutUrl()+'" style="border-bottom: none">\u767b\u51fa</a></li></ul></div><div class="ds-visitor">';return b+=x.data.url?'<a class="ds-visitor-name" href="'+t(x.data.url)+'" target="_blank">'+t(x.data.name)+"</a>":'<span class="ds-visitor-name">'+t(x.data.name)+"</span>",b+'<a class="ds-unread-comments-count" href="javascript:void(0);" title="\u65b0\u56de\u590d"></a></div></div>'};f.topThreads=function(b){var a=
"";if(b=b.response)for(var c,d=-1,f=b.length-1;f>d;)c=b[d+=1],a+='<li><a target="_blank" href="'+t(c.url)+'" title="'+t(c.title)+'">'+t(c.title)+"</a></li>";return a};f.topUsers=function(b){var a="",c=b.response;if(c)for(var d,h=-1,k=c.length-1;k>h;)d=c[h+=1],a+='<div class="ds-avatar">'+f.avatar(d,b.options.avatar_size)+"<h4>"+t(d.name)+"</h4></div>";return a};f.userInfo=function(b){var a='<a href="'+t(b.url)+'" onclick="this.href=\''+B()+"/user-url/?user_id="+b.user_id+'\';" class="ds-avatar" target="_blank">'+
f.avatarImg(b)+'</a><a href="'+t(b.url)+'" onclick="this.href=\''+B()+"/user-url/?user_id="+b.user_id+'\';" class="ds-user-name ds-highlight" target="_blank">'+t(b.name)+"</a>",c;for(c in b.social_uid)a+='<a href="'+d.REMOTE+"/user-proxy/"+c+"/"+b.social_uid[c]+'/" target="_blank" class="ds-service-icon ds-'+c+'" title="'+d.sourceName[c]+'"></a>';return a+='<p class="ds-user-card-meta"><a href="'+d.REMOTE+"/profile/"+b.user_id+'/" target="_blank"><span class="ds-highlight">'+b.comments+"</span>\u6761\u8bc4\u8bba</a></p>",
b.description&&(a+='<p class="ds-user-description">'+t(b.description)+"</p>"),a};var h=d.Views={},Da=(d.Callbacks={},d.pagelets=[]),va=d.events=new ia,T=d.site=new A,x=d.visitor=new pa,G=d.unread=new A,ka=d.threadPool=new z(qa),J=d.postPool=new z(ja),H=d.userPool=new z(pa);va.on("queryDefined",function(){var b=q.short_name;if(q.theme&&ta(q.theme),D){var a=D["ds_site_"+b],b=D["ds_lang_"+b];a&&T.reset(w.parse(a));b&&r.extend(n,w.parse(b))}});oa();d.require("embed.compat",function(){function b(a){a.stopPropagation()}
function a(a){(a.ctrlKey&&13==a.which||10==a.which)&&g(this.form).trigger("submit")}function c(){var a=g(this);a.height(Math.max(54,a.next(".ds-hidden-text").text(this.value).height()+27))}function e(){if(F.authInWin){var a=this.href.match(/\/(login|bind)\/(\w+)\//i);if(a&&d.serviceNames[a[2]])return!z(a[2],this.href)}}function l(){var a,b,c,d,f,u=0,e=0;k.selection&&(b=k.selection.createRange(),b&&b.parentElement()==this&&(d=this.value.length,a=this.value.replace(/\r\n/g,"\n"),c=this.createTextRange(),
c.moveToBookmark(b.getBookmark()),f=this.createTextRange(),f.collapse(!1),-1<c.compareEndPoints("StartToEnd",f)?u=e=d:(u=-c.moveStart("character",-d),u+=a.slice(0,u).split("\n").length-1,-1<c.compareEndPoints("EndToEnd",f)?e=d:(e=-c.moveEnd("character",-d),e+=a.slice(0,e).split("\n").length-1))));g(this).data("ds-range-start",u).data("ds-range-end",e)}function t(a){return F.touch&&a.addClass("ds-touch"),r.cssProperty("transition")||a.addClass("ds-no-transition"),F.ie6&&a.addClass("ds-ie6"),F.opacity||
a.addClass("ds-no-opacity"),a}function A(a){if(!F.placeholder){var b=a.attr("placeholder");a.val(b).focus(function(){this.value===b&&(this.value="")}).blur(function(){""===this.value&&(this.value=b)})}return a}function w(a){if("http://duoshuo.com"===a.origin)switch(a.data.type){case "login":Q.href=a.data.redirectUrl}}function z(a,b){var c={weibo:[760,600],renren:[420,322],qq:[504,445],weixin:[450,550],google:[600,440]}[a]||[550,400];return p.open(b+(-1==b.indexOf("?")?"?":"&")+r.param({origin:Q.origin||
"http://"+Q.host}),"_blank","width="+c[0]+",height="+c[1]+",toolbar=no,menubar=no,location=yes")}function L(a){var b=I[M()?"loginUrl":"bindUrl"](a);F.authInWin&&z(a,b)||(Q.href=b)}function U(b,N,e,g){var m=S(f["dialog-reposts"]({post:b.toJSON(),repostMessage:N,service:g})),u=m.el.find("form");return u.submit(function(){function a(b){if(e&&g){var c=e.options;b=R(e.postList.el,b.response[g],c);"asc"==c.order==("top"==c.formPosition)&&d.scrollTo(b);c=e.el.find(".ds-comments-tab-"+g+" span.ds-highlight");
c.html(parseInt(c.html())+1)}}return g||u.find("[type=checkbox]:checked")[0]?(C.post("posts/repost",d.toJSON(u),a),m.close(),!1):(alert("\u8fd8\u6ca1\u6709\u9009\u53d1\u5e03\u5230\u54ea\u513f\u5462"),!1)}),u.find(".ds-actions [type=checkbox]").change(function(){var a=this.value;return this.checked&&!x.data.social_uid["qqt"==a?"qq":a]?void L(a):void 0}),A(u.find("textarea")).keyup(a).keyup(c).focus(),!1}function V(a){var b={"unread-comments":{title:"\u65b0\u7559\u8a00\u53ca\u56de\u590d",apiUrl:"users/unreadComments",
tmpl:function(a){return a.thread?'<li data-thread-id="'+a.thread.thread_id+'">'+g.map(a.authors,f.userAnchor).join("\u3001")+' \u5728 <a class="ds-read" href="'+a.thread.url+'#comments" target="_blank">'+E(a.thread.title||"\u65e0\u6807\u9898")+'</a> \u4e2d\u56de\u590d\u4e86\u4f60 <a class="ds-delete ds-read" title="\u77e5\u9053\u4e86" href="javascript:void(0)">\u77e5\u9053\u4e86</a></li>':""},read:function(a){a=a.attr("data-thread-id");C.post("threads/read",{thread_id:a});G.data.comments--}},"unread-notifications":{title:"\u7cfb\u7edf\u6d88\u606f",
apiUrl:"users/unreadNotifications",tmpl:function(a){return'<li data-notification-id="'+a.notification_id+'" data-notification-type="'+a.type+'">'+a.content+' <a class="ds-delete ds-read" title="\u77e5\u9053\u4e86" href="javascript:void(0)">\u77e5\u9053\u4e86</a></li>'},read:function(a){a=a.attr("data-notification-id");C.post("notifications/read",{notification_id:a});G.data.notifications--}}}[a],c=S("<h2>"+b.title+'</h2><ul class="ds-unread-list"></ul>');c.on("close",d.resetNotify);var e=c.el.find(".ds-unread-list").delegate(".ds-delete",
"click",function(){return g(this).parent().remove(),0===e.children().length&&c.close(),!1}).delegate(".ds-read","click",function(){b.read(g(this).parent())});g("#ds-notify").hide();C.get(b.apiUrl,{},function(a){c.el.find(".ds-unread-list").html(g.map(a.response,b.tmpl).join("\n"))})}function W(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}function X(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0;P.detach()},400)}function R(a,b,c){return a.find(".ds-post[data-post-id="+
b.data.post_id+"]")[0]?void 0:(a.find(".ds-post-placeholder").remove(),g(f.post({post:b.toJSON(),options:c})).hide()["asc"==c.order?"appendTo":"prependTo"](a).slideDown(function(){}))}function Y(a,b){function c(){var b=this;if(bubbleOutTimer&&P.owner==b)return clearTimeout(bubbleOutTimer),void(bubbleOutTimer=0);var d=g(b);da=setTimeout(function(){function c(a){a=a.response;H[m]?H[m].set(a):H[m]=new pa(a);P.owner==b&&ea.html(f.userInfo(a))}da=0;P.owner=b;W();var e=d.offset(),N=a.el.offset(),g=d.innerWidth()/
2,la=a.el.innerHeight()-(e.top-N.top)+6,e=e.left-N.left-35+(35<g?35:g);try{if(d.hasClass("ds-comment-context"))ea.attr("id","ds-ctx-bubble").attr("data-post-id",d.attr("data-post-id")).html('<ul id="ds-ctx">'+f.ctxPost({post:J[d.attr("data-parent-id")].toJSON()})+'</ul><div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">\u67e5\u770b\u5bf9\u8bdd</a></div>');else if(d.hasClass("ds-avatar")||d.hasClass("ds-user-name")){var N={},m=N.user_id=d.attr("data-user-id");if(!m)throw"no info";
ea.attr("id","ds-user-card").attr("data-user-id",m).empty();H[m]?ea.html(f.userInfo(H[m].data)):C.get("users/profile",fa(N),c)}P.css({bottom:la,left:e}).appendTo(a.innerEl)}catch(h){P.detach()}},200)}function d(){da?(clearTimeout(da),da=0):bubbleOutTimer||X()}var m;this.delegate("a.ds-post-likes","click",function(){if(M())return S(f["dialog-ask-for-auth"]({})).el.find(".ds-dialog").css("width","300px").find("a.ds-service-link").click(e),!1;var a=g(this).parent(),b=a.hasClass("ds-post-liked"),c=g(this).html().match(/\((\d+)\)/),
c=(c?parseInt(c[1]):0)+(b?-1:1);return C.post("posts/vote",{post_id:a.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:b?0:1}),g(this).html(g(this).html().replace(/\(\d+\)/,"")+(c?"("+c+")":"")),a[b?"removeClass":"addClass"]("ds-post-liked"),!1}).delegate("a.ds-post-repost","click",function(){var a=g(this).closest(".ds-post-self"),a=J[a.attr("data-post-id")];return U(a,""),!1}).delegate("a.ds-post-delete","click",function(){if(!confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f"))return!1;
var b=g(this).closest(".ds-post-self");return C.post("posts/remove",{post_id:b.attr("data-post-id")}),b.parent().fadeOut(200,function(){a.data.comments--;a.updateCounter("duoshuo");g(this).remove()}),!1}).delegate("a.ds-post-report","click",function(){if(!confirm("\u786e\u5b9a\u8981\u4e3e\u62a5\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f"))return!1;var a=g(this).closest(".ds-post-self");return C.post("posts/report",{post_id:a.attr("data-post-id")}),alert("\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01"),!1}).delegate("a.ds-post-reply",
"click",function(){var c=g(this),d=c.closest(".ds-comment-actions");if(d.hasClass("ds-reply-active"))m.el.fadeOut(200,function(){g(this).detach()}),d.removeClass("ds-reply-active");else{var e=c.closest(".ds-ctx-entry, .ds-post-self");m?m.actionsBar.removeClass("ds-reply-active"):(m=new h.Replybox(a),m.render(!0).el.addClass("ds-inline-replybox").detach());m.el.find("[name=parent_id]").val(e.attr("data-post-id"));m.el.show().appendTo(c.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus();
m.actionsBar=d.addClass("ds-reply-active");1>=b.max_depth?m.postList=a.postList.el:(m.postList=e.siblings(".ds-children"),m.postList[0]||(m.postList=g('<ul class="ds-children"></ul>').insertAfter(e)))}return!1}).delegate("a.ds-weibo-comments","click",function(){function a(c){ha(c);d.append(g.map(c.response,function(a){return f.post({post:a,options:b})}).join(""))}var c=g(this).closest(".ds-post-self"),ba=c.attr("data-post-id");c.data("source");if(0!=c.attr("data-root-id"))return!1;var d=c.siblings(".ds-children");
return d[0]?(d.remove(),!1):(d=g('<ul class="ds-children"></ul>').insertAfter(c),C.get("posts/listComments",fa({post_id:ba}),a),!1)}).delegate("a.ds-weibo-reposts","click",function(){var b=g(this).closest(".ds-post-self"),b=J[b.attr("data-post-id")],c=b.data.source;if(!x.data.social_uid["qqt"==c?"qq":c])return void L(c);var d=b.data.root_id,e="0"!=d?J[d]:b,f="";"0"!=d&&(d=prepatePost(b.data).theAuthor,f=("weibo"==c?"//@"+d.name:"|| @"+d.qqt_account)+":"+b.data.message);return U(e,f,a,c),!1}).delegate("a.ds-expand",
"click",function(){var a=g(this).parent();return a.siblings().show(),a.remove(),!1});F.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",c).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",d)}function fa(a){var b={require:"site,visitor,nonce,lang"+(aa++?"":",unread,log,extraCss"),site_ims:ga.get("ds_site_"+q.short_name+":timestamp"),lang_ims:ga.get("ds_lang_"+q.short_name+":timestamp"),referer:k.referrer};q.stylePatch&&(b.style_patch=q.stylePatch);
for(var c in b)b[c]&&(!F.ie6||200>encodeURIComponent(b[c]).length)&&(a[c]=b[c]);return a}var g=d.jQuery,ma=g(p),Z=g(k);p.postMessage&&(p.addEventListener?p.addEventListener("message",w,!1):p.attachEvent&&p.attachEvent("onmessage",w));d.scrollTo=function(a){a=a.offset().top;(a<ma.scrollTop()||a>ma.scrollTop()+ma.height())&&g("html, body").animate({scrollTop:a-40},200,"swing")};d.toJSON=function(a){var b=/\r?\n/g,c=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,
d=/^(?:select|textarea)/i;a=a.map(function(){return this.elements?g.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||d.test(this.nodeName)||c.test(this.type))}).map(function(a,c){var d=g(this).val();return null==d?null:g.isArray(d)?g.map(d,function(a){return{name:c.name,value:a.replace(b,"\r\n")}}):{name:c.name,value:d.replace(b,"\r\n")}}).toArray();var e={};return g.each(a,function(){e[this.name]=this.value}),e};d.resetNotify=function(){var a=g("#ds-notify"),
b=G.data;a[0]||(a=g('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[T.data.notify_position]).delegate(".ds-notify-unread a","click",function(){return V(g(this).data("type")),!1}).appendTo(k.body));a.html(f.notify(b))[!b.comments&&!b.notifications||"hidden"===T.data.notify_position||g(".ds-dialog")[0]?"hide":"show"]()};G.on("reset",d.resetNotify);h.Replybox=function(a){this.embedThread=a};h.Replybox.prototype=
{render:function(b){function N(a){a.data("submitting",!0);a.find(".ds-post-button").addClass("ds-waiting").html(n.posting)[0].disabled=!0}function la(a){a.data("submitting",!1);a.find(".ds-post-button").removeClass("ds-waiting").html(n.post)[0].disabled=!1}var O=this,m=O.embedThread,u=m.options,p=function(){d.require("smilies",function(){})},q={thread:m,options:u,inline:b,params:{thread_id:m.threadId,parent_id:"",nonce:d.nonce},repostArray:[],checked:0},r;for(r in x.data.repostOptions)x.data.repostOptions[r]&&
(q.repostArray.push(r),q.checked=1);for(var t={"#[aru_1]":"aru_1"},w=2;165>w;w++)t["#[aru_"+w+"]"]="aru_"+w;var z=O.el=g(f.replybox(q)).click(p),v=z.find("form"),B=v.find("input[type=checkbox]")[0],E=v.find("a.ds-service-icon, a.ds-service-icon-grey"),y=A(v.find("textarea")).focus(p).keyup(a).keyup(c).bind("focus mousedown mouseup keyup",l),I=z.find(".ds-add-emote").click(function(a){var b=d.smiliesTooltip;return I.toggleClass("ds-expanded").hasClass("ds-expanded")?(b||(b=d.smiliesTooltip=new h.SmiliesTooltip,
b.render(),DUOSHUO.addSmilies("\u6ed1\u7a3d",{"#[\u5475\u5475]":"\u5475\u5475","#[\u54c8\u54c8]":"\u54c8\u54c8","#[\u5410\u820c]":"\u5410\u820c","#[\u554a]":"\u554a","#[\u9177]":"\u9177","#[\u6012]":"\u6012","#[\u5f00\u5fc3]":"\u5f00\u5fc3","#[\u6c57]":"\u6c57","#[\u6cea]":"\u6cea","#[\u9ed1\u7ebf]":"\u9ed1\u7ebf","#[\u9119\u89c6]":"\u9119\u89c6","#[\u4e0d\u9ad8\u5174]":"\u4e0d\u9ad8\u5174","#[\u771f\u68d2]":"\u771f\u68d2","#[\u94b1]":"\u94b1","#[\u7591\u95ee]":"\u7591\u95ee","#[\u9634\u9669]":"\u9634\u9669",
"#[\u5410]":"\u5410","#[\u54a6]":"\u54a6","#[\u59d4\u5c48]":"\u59d4\u5c48","#[\u82b1\u5fc3]":"\u82b1\u5fc3","#[\u547c]":"\u547c","#[\u7b11\u773c]":"\u7b11\u773c","#[\u51b7]":"\u51b7","#[\u592a\u5f00\u5fc3]":"\u592a\u5f00\u5fc3","#[\u6ed1\u7a3d]":"\u6ed1\u7a3d","#[\u52c9\u5f3a]":"\u52c9\u5f3a","#[\u72c2\u6c57]":"\u72c2\u6c57","#[\u4e56]":"\u4e56","#[\u7761\u89c9]":"\u7761\u89c9","#[\u60ca\u54ed]":"\u60ca\u54ed","#[\u751f\u6c14]":"\u751f\u6c14","#[\u60ca\u8bb6]":"\u60ca\u8bb6","#[\u55b7]":"\u55b7",
"#[\u73ab\u7470]":"\u73ab\u7470","#[\u793c\u7269]":"\u793c\u7269","#[\u5f69\u8679]":"\u5f69\u8679","#[\u94b1\u5e01]":"\u94b1\u5e01","#[\u706f\u6ce1]":"\u706f\u6ce1","#[\u8336\u676f]":"\u8336\u676f","#[\u97f3\u4e50]":"\u97f3\u4e50","#[haha]":"haha","#[\u80dc\u5229]":"\u80dc\u5229","#[\u5927\u62c7\u6307]":"\u5927\u62c7\u6307","#[\u5f31]":"\u5f31"}),DUOSHUO.addSmilies("\u963f\u9c81",t),DUOSHUO.addSmilies("\u5fae\u535a",{"#[doge]":"doge","#[miao]":"miao","#[dog1]":"dog1","#[dog2]":"dog2","#[dog3]":"dog3",
"#[dog4]":"dog4","#[dog5]":"dog5","#[dog6]":"dog6","#[dog7]":"dog7","#[dog8]":"dog8","#[dog9]":"dog9","#[dog10]":"dog10","#[dog11]":"dog11","#[dog12]":"dog12","#[dog13]":"dog13","#[dog14]":"dog14","#[dog15]":"dog15","#[aini]":"aini","#[aoteman]":"aoteman","#[baibai]":"baibai","#[beishang]":"beishang","#[bishi]":"bishi","#[bizui]":"bizui","#[chanzui]":"chanzui","#[chijing]":"chijing","#[dahaqi]":"dahaqi","#[dalian]":"dalian","#[ding]":"ding","#[feizao]":"feizao","#[ganmao]":"ganmao","#[guzhang]":"guzhang",
"#[haha.]":"haha.","#[haixiu]":"haixiu","#[hehe]":"hehe","#[heixian]":"heixian","#[heng]":"heng","#[huaxin]":"huaxin","#[jiyan]":"jiyan","#[keai]":"keai","#[kelian]":"kelian","#[ku]":"ku","#[kun]":"kun","#[landelini]":"landelini","#[lei]":"lei","#[nanhaier]":"nanhaier","#[nu]":"nu","#[numa]":"numa","#[nvhaier]":"nvhaier","#[qian]":"qian","#[qinqin]":"qinqin","#[shayan]":"shayan","#[shengbing]":"shengbing","#[shenshou]":"shenshou","#[shiwang]":"shiwang","#[shuai]":"shuai","#[shuijiao]":"shuijiao",
"#[sikao]":"sikao","#[taikaixin]":"taikaixin","#[touxiao]":"touxiao","#[tu]":"tu","#[tuzi]":"tuzi","#[wabishi]":"wabishi","#[weiqu]":"weiqu","#[xiaoku]":"xiaoku","#[xiongmao]":"xiongmao","#[xixi]":"xixi","#[xu]":"xu","#[yinxian]":"yinxian","#[yiwen]":"yiwen","#[youhengheng]":"youhengheng","#[yun]":"yun","#[zhuakuang]":"zhuakuang","#[zhutou]":"zhutou","#[zuiyou]":"zuiyou","#[zuohengheng]":"zuohengheng","#[geili]":"geili","#[hufen]":"hufen","#[jiong]":"jiong","#[meng]":"meng","#[shenma]":"shenma","#[v5]":"v5",
"#[xi]":"xi","#[zhi]":"zhi"}),DUOSHUO.addSmilies("\u6597\u56fe",{"$[:a:]":"a","$[:b:]":"b","$[:c:]":"c","$[:d:]":"d","$[:e:]":"e","$[:f:]":"f","$[:g:]":"g","$[:h:]":"h","$[:i:]":"i","$[:j:]":"j","$[:k:]":"k","$[:l:]":"l","$[:m:]":"m","$[:n:]":"n","$[:p:]":"p","$[:r:]":"r","$[:o:]":"o","$[:s:]":"s","$[:t:]":"t","$[:u:]":"u","$[:v:]":"v","$[:w:]":"w","$[:q:]":"q","$[:x:]":"x"}),DUOSHUO.addSmilies("\u989c\u6587\u5b57",{"O(\u2229_\u2229)O":"","(*/\u03c9\uff3c*)":"","\uff08\uffe3\u25bd\uffe3\uff09":"",
"(=\u30fb\u03c9\u30fb=)":"","(\uff40\u30fb\u03c9\u30fb\u00b4)":"","(\u301c\uffe3\u25b3\uffe3)\u301c":"","(\uff65\u2200\uff65)":"","(\u00b0\u2200\u00b0)\uff89":"","(\uffe33\uffe3)":"","\u256e(\uffe3\u25bd\uffe3)\u256d":"","( \u00b4_\u309d\uff40)":"","\u2190_\u2190":"","\u2192_\u2192":"","(<_<)":"","(>_>)":"","(;\u00ac_\u00ac)":"","(\uff9f\u0414\uff9f\u2261\uff9f\u0434\uff9f)!?":"","\u03a3(\uff9f\u0434\uff9f;)":"","\u03a3( \uffe3\u25a1\uffe3||)":"","(\u00b4\uff1b\u03c9\uff1b`)":"","\uff08/T\u0414T)/":"",
"(^\u30fb\u03c9\u30fb^ )":"","(\uff61\uff65\u03c9\uff65\uff61)":"","(\u25cf\uffe3(\uff74)\uffe3\u25cf)":"","\u03b5=\u03b5=(\u30ce\u2267\u2207\u2266)\u30ce":"","(\u00b4\uff65_\uff65`)":"","(-_-#)":"","\uff08\uffe3\u3078\uffe3\uff09":"","(\uffe3\u03b5(#\uffe3) \u03a3":"","\u30fd(`\u0414\u00b4)\uff89":"","(\u256f\u00b0\u53e3\u00b0)\u256f(\u2534\u2014\u2534":"","\uff08#-_-)\u252f\u2501\u252f":"","_(:3\u300d\u2220)_":"","\u9fb4\u2180\u25e1\u2180\u9fb4":"","\u250c( \u0ca0_\u0ca0)\u2518":"","( \u00b4\u2565\u03c9\u2565`)":"",
"(\u2044 \u2044\u2022\u2044\u03c9\u2044\u2022\u2044 \u2044)\u2044":"","(\u3065\uffe3 \u00b3\uffe3)\u3065":"","\u0ca5_\u0ca5":""}),d.require("smilies",function(){b.reset("\u6ed1\u7a3d")})),b.replybox=O,b.el.appendTo(k.body).css({top:O.el.offset().top+O.el.outerHeight()+4+"px",left:O.el.find(".ds-textarea-wrapper").offset().left+"px"}),g(k.body).click(G)):G(a),!1}),G=(z.find(".ds-add-image").click(function(a){var b=y[0],c=b.value;k.selection?(b.value=c.substring(0,y.data("ds-range-start"))+'<img src="\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740" />'+
c.substring(y.data("ds-range-end"),c.length),b.value=b.value.replace("\u8bf4\u70b9\u4ec0\u4e48\u5427 ...",""),b.focus(),b=k.selection.createRange(),b.collapse(),b.findText("\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740"),b.select()):(b.value=c.substring(0,b.selectionStart)+'<img src="\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740" />'+c.substring(b.selectionEnd),c=b.value.search("\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740"),b.setSelectionRange(c,c+7),b.focus());a.preventDefault()}),O.hideSmilies=function(){I.removeClass("ds-expanded");
d.smiliesTooltip.el.detach();g(k.body).unbind("click",G)}),K=function(a,b){var c=S(f["dialog-anonymous"]({services:"weixin weibo qq renren kaixin douban".split(" "),options:u}));if(c.el.find(".ds-dialog").css("width","320px").find(".ds-icons-32 a").click(e),!u.deny_anonymous){var ba=c.el.find("form");ba.submit(function(){var a=ba.find("input[name=author_email]").val();return!a&&!u.require_guest_email||a.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?
(b(d.toJSON(ba)),c.close(),!1):(alert("\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684email\u5730\u5740."),!1)});ba.find("input[name=author_name]")[0].focus()}};u.deny_anonymous&&y.focus(function(){if(M()){K(v,H);var a=function(b){b.stopPropagation();y.unbind("click",a)};y.click(a)}return!1});var H=function(a){N(v);C.post("posts/create",g.extend(d.toJSON(v),a),function(a){a=J[a.response.post_id]=new ja(a.response);a=R(O.postList,a,u);if("asc"==u.order==("top"==u.formPosition)&&d.scrollTo(a),m.data.comments++,
m.updateCounter("duoshuo"),y.val("").trigger("keyup"),la(v),z.hasClass("ds-inline-replybox")&&(z.detach(),O.actionsBar.removeClass("ds-reply-active")),D)try{D.removeItem("ds_draft_"+m.threadId)}catch(b){}},function(a){la(v);alert(a.errorMessage)})};v.submit(function(){if(v.data("submitting"))return!1;var a=g.trim(v[0].message.value);return""==a||!F.placeholder&&a==y.attr("placeholder")?(alert("\u60a8\u8fd8\u6ca1\u5199\u5185\u5bb9\u5462"),!1):(M()?K(v,H):H(),!1)});var L=function(a){return g(a).hasClass("ds-service-icon-grey")?
null:g(a).attr("data-service")};if(E.click(function(){return g(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),B.value=g.map(E,L).join(","),B.checked=""!=B.value,!1}),g(B).change(function(){var a=this.checked;E[a?"removeClass":"addClass"]("ds-service-icon-grey")[a?"addClass":"removeClass"]("ds-service-icon");this.value=g.map(E,L).join(",")}),!b&&D)w="ds_draft_"+m.threadId,y.bind("focus blur keyup",function(a){a=g(a.currentTarget).val();try{D[w]=a}catch(b){}}),D[w]&&y.val(D[w]);
return this}};h.Dialog=ia.extend({init:function(a,b){(this.el=g("#ds-wrapper"))[0]||(this.el=t(g('<div id="ds-wrapper"></div>')));this.options=g.extend({width:600},b);a!==v&&g(a).attr("id","ds-reset").appendTo(this.el)},open:function(){function a(b){return 27==b.which?(d.close(),!1):void 0}function c(){return d.close(),!1}var d=this;return d.el.hide().appendTo(k.body).fadeIn(200),F.ie6&&d.el.css("top",ma.scrollTop()+100),d.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(){return d.close(),
!1}).click(b),Z.keydown(a),g(k.body).click(c),d.close=function(){Z.unbind("keydown",a);g(k.body).unbind("click",c);d.el.fadeOut(200,function(){g(this).remove()});d.trigger("close")},d}});f.likePanel=function(a){return a.likes?'<span class="ds-highlight">'+a.likes+"</span> \u4eba\u559c\u6b22":""};h.Meta=function(a){this.embedThread=a};h.Meta.prototype={render:function(){var a=this,c=a.embedThread.model,d=a.el=g(f.meta(c.toJSON())),e=d.find(".ds-like-thread-button");return e.click(function(m){function u(){a.tooltip.detach();
g(k.body).unbind("click",u)}function h(a){switch(this.className){case "ds-like-tooltip-close":u(a);break;default:if(!p.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no"))return}return!1}var l=e.hasClass("ds-thread-liked");if(C.post("threads/vote",{thread_id:a.embedThread.threadId,vote:l?0:1},function(b){c.set(b);a.resetLikePanel()}),e.toggleClass("ds-thread-liked"),e.find(".ds-thread-like-text").text(l?"\u559c\u6b22":"\u5df2\u559c\u6b22"),
l)return a.tooltip&&u(m),!1;a.tooltip===v&&(m=f.likeTooltip({services:{qzone:"QQ\u7a7a\u95f4",weibo:"\u65b0\u6d6a\u5fae\u535a",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",kaixin:"\u5f00\u5fc3\u7f51",douban:"\u8c46\u74e3\u7f51",baidu:"\u767e\u5ea6\u641c\u85cf"},thread_id:c.data.thread_id}),a.tooltip=g(m).click(b).delegate("a","click",h));m={};return m.left=0,m.top=d.position().top+d.outerHeight()-4+"px",a.tooltip.appendTo(a.embedThread.innerEl).css(m),g(k.body).click(u),!1}),a.resetLikePanel(),
M()&&d.hide(),a},resetLikePanel:function(){this.el.find(".ds-like-panel").html(f.likePanel(this.embedThread.model.toJSON()))}};h.PostListHead=function(a){this.embedThread=a};h.PostListHead.prototype={render:function(){var a=this.embedThread,b=a.postList,c=this.el=g(f.postListHead({thread:a.model.toJSON(),options:a.options})),d=c.find("ul.ds-comments-tabs");d.delegate(".ds-tab a","click",function(c){d.find("a.ds-current").removeClass("ds-current");b.params.page=1;c=c.currentTarget;switch(c.className){case "ds-comments-tab-duoshuo":b.params.source=
"duoshuo";a.replybox.el.show();break;case "ds-comments-tab-repost":b.params.source="repost";a.replybox.el.hide();break;case "ds-comments-tab-weibo":b.params.source="weibo";a.replybox.el.hide();break;case "ds-comments-tab-qqt":b.params.source="qqt",a.replybox.el.hide()}return g(c).addClass("ds-current"),b.refetch(),!1});var e=c.find(".ds-sort");return e.delegate("a","click",function(){return e.find("a.ds-current").removeClass("ds-current"),b.params.order=a.options.order=this.className.replace("ds-order-",
""),b.params.page=1,b.refetch(),g(this).addClass("ds-current"),!1}),e.find(".ds-order-"+b.params.order).addClass("ds-current"),this}};h.Paginator=function(a){a=a||{};var b=this.el=a.el||g('<div class="ds-paginator"></div>'),c=this.collection=a.collection;b.delegate("a","click",function(){return c.params.page=parseInt(this.innerHTML),c.refetch(),b.find(".ds-current").removeClass("ds-current"),g(this).addClass("ds-current"),!1})};h.Paginator.prototype={reset:function(a){function b(a){e.push('<a data-page="'+
a+'" href="javascript:void(0);">'+a+"</a>")}var c,d=this.collection.params.page||1,e=[];if(1<d)for(b(1),c=4<d?d-2:2,2<c&&e.push('<span class="page-break">...</span>');d>c;c++)b(c);if(e.push('<a data-page="'+d+'" href="javascript:void(0);" class="ds-current">'+d+"</a>"),d<a.pages){for(c=d+1;d+4>=c&&c<a.pages;c++)b(c);c<a.pages&&e.push('<span class="page-break">...</span>');b(a.pages)}this.el.html('<div class="ds-border"></div>'+e.join(" "))[1<a.pages?"show":"hide"]()}};d.addSmilies=function(a,b){var c=
d.smiliesTooltip;["\u6ed1\u7a3d","\u5fae\u535a","\u989c\u6587\u5b57","\u963f\u9c81","\u6597\u56fe"].some(function(b){return b===a})&&(c&&c.el.find("ul.ds-smilies-tabs").append("<li><a>"+a+"</a></li>"),d.smilies[a]=b)};h.SmiliesTooltip=function(){};h.SmiliesTooltip.prototype={render:function(){function a(){var b=c.replybox,d=b.el.find("textarea"),e=d[0],f=e.value;k.selection?(e.value=f.substring(0,d.data("ds-range-start"))+this.title+f.substring(d.data("ds-range-end"),f.length),e.value=e.value.replace(n.leave_a_message,
""),e.focus(),f=k.selection.createRange(),f.moveStart("character",d.data("ds-range-start")+this.title.length),f.collapse(),f.select()):(d=e.selectionStart+this.title.length,e.value=f.substring(0,e.selectionStart)+this.title+f.substring(e.selectionEnd),e.setSelectionRange(d,d));b.hideSmilies();e.focus()}var c=this,d=c.el=g(f.smiliesTooltip(wa));return d.click(b).find("ul.ds-smilies-tabs").delegate("a","click",function(){c.reset(this.innerHTML)}),d.find(".ds-smilies-container").delegate("img","click",
a),d.find(".ds-smilies-container").delegate("span","click",a),this},reset:function(a){var b=this.el.find("ul.ds-smilies-tabs");b.find("a.ds-current").removeClass("ds-current");b.find("a").filter(function(){return this.innerHTML==a}).addClass("ds-current");var c="<ul>";return g.each(wa[a],function(b,e){var f=0===a.indexOf("\u5fae\u535a")?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+e.replace("_org","_thumb"):d.STATIC_URL+"/images/smilies/"+e,f=f.replace(/http:\/\/img\.t\.sinajs\.cn\//g,
"http://img.t.sinajs.cn/");0===a.indexOf("\u6ed1\u7a3d")?(f="",void 0!=window.devicePixelRatio&&1.49<=window.devicePixelRatio&&(f="@2x"),f="http://labcdn.qiniudn.com/sm/paopao/"+e+f+".png"):0===a.indexOf("\u963f\u9c81")?f="http://labcdn.qiniudn.com/sm/ARU/"+e+".png":0===a.indexOf("\u5fae\u535a")&&(f="http://labcdn.qiniudn.com/sm/Doge/"+e+".png");0===a.indexOf("\u989c\u6587\u5b57")?c+='<li style="width:auto;margin:0 7px;"><span class="yan" title="'+b+'" height=22 >'+b+"</span></li>":0===a.indexOf("\u6597\u56fe")?
c+='<li style="width:auto; height:60px; margin:2px;"><img src="http://labcdn.qiniudn.com/sm/QQ2016/'+e+'.jpg" height="60" title="$[:'+e+':]" /></li>':("WordPress"===a&&(b=" "+b+" "),c+='<li style="width:auto; height:40px; margin:0 7px;"><img src="'+f+'" title="'+E(b)+'" height=30 /></li>')}),c+="</ul>",this.el.find(".ds-smilies-container").html(c),this}};f.postPlaceholder=function(){return['<li class="ds-post ds-post-placeholder">',n.no_comments_yet,"</li>"].join("")};var P=g('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),
ea=P.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(){var a={};a.post_id=ea.attr("data-post-id");C.get("posts/conversation",a,function(a){function c(a,b){return f.ctxPost({post:a,index:b})}y.log(g.map(a.response,c).join("\n"));b.el.find("ol");b.el.find("ol").html(g.map(a.response,c).join("\n"))});var b=S('<h2>\u67e5\u770b\u5bf9\u8bdd</h2><ol id="ds-ctx"></ol>');return b.el.find(".ds-dialog").css("width","600px"),b.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px",
"overflow-y":"auto","padding-top":"10px"}),!1}),da=bubbleOutTimer=0;P.mouseenter(W).mouseleave(X);h.PostList=function(a){a&&(a.params&&(this.params=a.params),a.embedThread&&(this.embedThread=a.embedThread));this.el=g('<ul class="ds-comments"></ul>')};h.PostList.prototype={url:"threads/listPosts",render:function(){return Y.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(a){var b=this.embedThread.options;this.el.html(a[0]?g.map(J.getJSON(a),function(a){return f.post({post:a,
options:b})}).join(""):f.postPlaceholder())},refetch:function(){var a=this,b=g(f.indicator()).appendTo(k.body).fadeIn(200);a.el.fadeTo(200,.5);C.get(a.url,a.params,function(c){J.set(c.parentPosts||c.relatedPosts);H.set(c.users);a.reset(c.response);a.embedThread.paginator.reset(c.cursor);a.el.fadeTo(200,1);d.scrollTo(a.el);b.remove()})}};h.RelatedRead=function(){this._init()};h.RelatedRead.prototype={_init:function(){this.el=g('<div id="ds-related-reads"></div>')},load:function(a){p.__duoshuo_id__=
a;p.readsByToutiao=[];p.readsByToutiao.push({id:"ds-related-reads",num:3});a=k.createElement("script");a.src="//s0.pstatp.com/site/reads-sdk/5bf3702b38076207bee1.js";a.charset="utf-8";a.crossOrigin="anonymous";k.head.appendChild(a)},mount:function(a){this.el.insertBefore(a)}};h.EmbedThread=K.extend({uri:"threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(na.match(/MSIE 6\.0/)?
"":" title image thumbnail"),render:function(){var a=this.el;if("\u8bf7\u5c06\u6b64\u5904\u66ff\u6362\u6210\u6587\u7ae0\u5728\u4f60\u7684\u7ad9\u70b9\u4e2d\u7684ID"===a.data("thread-key"))return alert("\u8bf7\u8bbe\u7f6e\u6b63\u786e\u7684 data-thread-key \u5c5e\u6027"),!1;a.attr("id","ds-thread").append(f.waitingImg());var b=a.width(),c=a.data("url")||!a.attr("data-thread-id")&&g("link[rel=canonical]").attr("href");c?a.data("url",Ba(c)):a.data("container-url",Q.href);b&&400>=b&&a.addClass("ds-narrow").data("max-depth",
1)},updateCounter:function(a){function b(a){return a.substr(a.indexOf("}")+1)}var c={duoshuo:["comments",b(n.comments_multiple)||"\u8bc4\u8bba"],repost:["reposts",b(n.reposts_multiple)||"\u8f6c\u8f7d"],weibo:["weibo_reposts",b(n.weibo_reposts_multiple)||"\u65b0\u6d6a\u5fae\u535a"],qqt:["qqt_reposts",b(n.qqt_reposts_multiple)||"\u817e\u8baf\u5fae\u535a"]},d;for(d in c)if(!a||a==d){var e=this.data[c[d][0]];this.el.find(".ds-comments-tab-"+d).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+
d+'"></span>'+e:(e?'<span class="ds-highlight">'+e+"</span>":"0")+c[d][1])}},onError:function(a){this.el.html("\u8bc4\u8bba\u6846\u51fa\u9519\u5566("+a.code+"): "+a.errorMessage)},onload:function(a){var b=this,c=b.threadId=a.thread.thread_id,l=a.cursor,m=b.options=a.options,k=b.innerEl=t(g('<div id="ds-reset"></div>').appendTo(b.el));b.model=new qa(b.data=a.thread);J.set(a.parentPosts||a.relatedPosts);H.set(a.users);b.el.find("#ds-waiting").remove();a.options&&a.options.show_recommend&&(b.relatedRead=
new h.RelatedRead,b.relatedRead.load(a.thread.site_id),b.relatedRead.mount(k));m.like_thread_enabled&&(b.meta=new h.Meta(b),k.append(b.meta.render().el));m.hot_posts&&a.hotPosts&&a.hotPosts.length&&(b.hotPosts=new h.HotPosts(g('<div class="ds-rounded"></div>'),{max_depth:1,show_context:m.show_context}),b.hotPosts.thread=b,k.append(b.hotPosts.el),b.hotPosts.onload({list:J.getJSON(a.hotPosts)}));b.postListHead=new h.PostListHead(b);b.postList=new h.PostList({embedThread:b,params:{source:"duoshuo",thread_id:c,
max_depth:m.max_depth,order:m.order,limit:m.limit}});b.postList.render().reset(a.response);b.paginator=new h.Paginator({collection:b.postList});b.paginator.reset(l);c=b.replybox=new h.Replybox(b);c.postList=b.postList.el;M()?b.loginButtons=g(f.loginButtons()).delegate("a.ds-more-services","click",function(){return b.loginButtons.find(".ds-additional-services").toggle(),!1}).delegate("a.ds-service-link","click",e):b.toolbar=g(f.toolbar()).delegate(".ds-account-control","mouseenter",function(){g(this).addClass("ds-active")}).delegate(".ds-account-control",
"mouseleave",function(){g(this).removeClass("ds-active")}).delegate("a.ds-bind-more","click",function(){return S(f["dialog-bind-more"]()).el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px").find("a.ds-service-link").click(e),!1}).delegate("a.ds-unread-comments-count","click",function(){return V("unread-comments"),!1});l=['<a name="respond"></a>',b.toolbar||b.loginButtons,c.render().el];"top"==m.formPosition&&g.fn.append.apply(k,l);k.append(b.postListHead.render().el,b.postList.el,
b.paginator.el);"bottom"==m.formPosition&&g.fn.append.apply(k,l);k.append(f.poweredBy(m.poweredby_text));b.updateCounter();a.alerts&&g.each(a.alerts,function(a,c){g('<div class="ds-alert">'+c+"</div>").insertBefore(b.toolbar||loginButtons)});m.message&&c.el.find("textarea").val(m.message).focus();G.on("reset",function(){var a=G.data.comments||0;k.find("a.ds-unread-comments-count").html(a).attr("title",a?"\u4f60\u6709"+a+"\u6761\u65b0\u56de\u590d":"\u4f60\u6ca1\u6709\u65b0\u56de\u590d").css("display",
a?"inline":"none")});m.mzadx_id&&(d.require("mzadxN",function(){}),g('<div id="MZADX_'+m.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(k),__mz_rpq=p.__mz_rpq||[],__mz_rpq.push({l:[m.mzadx_id],r:"1",_srv:"MZADX",_callback:function(){}}));d.thread=b;G.data!==v&&G.trigger("reset");M()||ya.send({visit_thread_id:b.threadId})},onMessage:function(a){R(this.postList.el,new ja(a),this.options)}});h.HotPosts=K.extend({tmpl:"hotPosts",params:"show-quote",render:function(){return this.el.attr("id","ds-hot-posts"),
this},onload:function(a){a.options=g.extend(this.options,a.options);K.prototype.onload.call(this,a);Y.call(this.el.find("ul"),this.thread,this.options)}});h.RecentComments=K.extend({tmpl:"commentList",uri:"sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",render:function(){this.el.attr("id","ds-recent-comments")},prepare:function(a){return{list:g.map(a.response,function(a){return(new ja(a)).toJSON()})}}});h.RecentVisitors=
K.extend({tmpl:"recentVisitors",uri:"sites/listVisitors",params:"show-time avatar-size num-items channel-key",render:function(){this.el.children().detach();this.el.attr("id","ds-recent-visitors").append(this.waitingEl=g(f.waitingImg()))}});h.TopThreads=K.extend({tmpl:"topThreads",uri:"sites/listTopThreads",params:"range num-items channel-key",render:function(){this.el.children().detach();this.el.attr("id","ds-top-threads").append(this.waitingEl=g(f.waitingImg()))}});h.LoginWidget=K.extend({tmpl:"loginWidget",
render:function(){var a=this.el;a.attr("id","ds-login").html(f.loginWidget("weixin weibo qq renren kaixin douban".split(" ")));a.find("a").click(e);a.find("a.ds-logout").attr("href",I.logoutUrl())}});h.ThreadCount=K.extend({onload:function(a){var b=this.el,c=b.data("count-type")||"comments";a=a.data[c];b[b.data("replace")?"replaceWith":"html"](n[c+"_"+(a?1<a?"multiple":"one":"zero")].replace("{num}",a))}});h.ShareWidget=K.extend({tmpl:"shareWidget",render:function(){var a={copyright:"\u591a\u8bf4\u5206\u4eab\u63d2\u4ef6",
services:"weibo qzone sohu renren netease qqt kaixin douban qq meilishuo mogujie baidu taobao google wechat diandian huaban duitang youdao pengyou facebook twitter linkedin msn".split(" ")};this.el.attr("id","ds-share");this.el.children().attr("id","ds-reset");this.el.find(".ds-share-aside-inner").html(f.shareWidget(a));this.el.find(".ds-share-icons-more").html(f.shareWidget(a));this.el.find(".ds-share-icons-more").hide();this.el.hasClass("flat")&&this.el.find("a").each(function(){g(this).addClass("flat")});
t(this.el);this.delegateEvents()},delegateEvents:function(){var a=this.el;if(a.children().hasClass("ds-share-inline")){var b=a.find(".ds-share-icons-more");a.delegate("[data-toggle=ds-share-icons-more]","mouseover",function(){b.show()});a.delegate("[data-toggle=ds-share-icons-more]","mouseout",function(){b.hide()});a.delegate(".ds-share-icons-more","mouseover",function(){b.show()});a.delegate(".ds-share-icons-more","mouseout",function(){b.hide()})}else{var c=a.children().hasClass("ds-share-aside-left")?
"slide-to-right":"slide-to-left",d=a.children();if(!r.cssProperty("transition")){var e=a.children().hasClass("ds-share-aside-left")?"left":"right";a.delegate(".ds-share-aside-toggle","mouseover",function(){var a={};F.ie6&&"right"===e?a.left=(k.documentElement.scrollLeft+k.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)-195:a[e]=0;d.animate(a,200)});a.delegate(".ds-share-aside-inner","mouseleave",function(){var a=
{};F.ie6&&"right"===e?a.left=(k.documentElement.scrollLeft+k.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)+230:a[e]=-229;d.animate(a,200)})}a.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseover",function(){d.addClass(c)});a.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseleave",function(){d.removeClass(c)})}a.delegate("a","click",function(b){var c=g(this).data("service");if(!a.data("url"))return void alert("\u8bf7\u8bbe\u7f6edata-url");
if("wechat"===c){var c=B()+"/api/qrcode/getImage.png",d="?size=240&text="+a.data("url");S(f["dialog-qrcode"]({qrcode_url:c+d,url:a.data("url")})).el.find(".ds-dialog").css("width","320px")}else c=B()+"/share-proxy/?"+r.param({service:g(this).data("service"),thread_key:a.data("threadKey"),title:a.data("title"),images:a.data("images"),content:a.data("content"),url:a.data("url")}),p.open(c,"_blank");b.preventDefault();b.stopPropagation()})}});var aa=0;d.initSelector=function(a,b){function c(a){ha(a);
r.extend(n,a.options);ka.set(a.response)}var d=[];!oa()||!g.isReady&&Ca||g(a).each(function(a,c){var e=g(c);if(!e.data("initialized")){e.data("initialized",!0);var f=new h[b.type](e,b);if(Da.push(f),"ThreadCount"===b.type){var k=e.attr("data-thread-key");e.attr("data-channel-key")&&(k=e.attr("data-channel-key")+":"+k);d.push(k);ka[k]||(ka[k]=new qa({}));ka[k].on("reset",function(){f.onload(this)})}else if(f.uri){var l={};g.each(f.params.split(" "),function(a,b){l[b.replace(/-/g,"_")]=e.attr("data-"+
b)||e.data(b)});C.get(f.uri,fa(l),function(a){f.load(a)})}}});d.length&&C.get("threads/counts",fa({threads:d.join(",")}),c)};(d.initView=function(){g.each(ca,d.initSelector)})();g(function(){if(!q){if(!oa())return y.error("\u7f3a\u5c11 duoshuoQuery \u7684\u5b9a\u4e49");y.warn("\u8bf7\u5728\u52a0\u8f7d\u591a\u8bf4 embed.js \u4e4b\u524d\u5b9a\u4e49 duoshuoQuery")}setInterval(function(){g(".ds-time").each(function(){var a=g(this).attr("datetime");a&&(this.innerHTML=d.elapsedTime(a))})},2E4);q.ondomready&&
q.ondomready();d.initView();!aa&&q.short_name&&C.get("analytics/ping",fa({}),ha)})})}}(window,document);